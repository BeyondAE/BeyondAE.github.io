---
title : 인수인계3
description : 인수인계3
date : 2018-01-12
categories :
- jiran
tags :
- jiran
---

# demo 3
- 업체쪽에서 체험하는 데모 서버
- @로 들어오면 Guest폴더
- 자잘하게라도 한 건 계속 써둬라
- user_info의 idx 3번은 Guest이다.
- appdisk_enable가 기본 N여서 전탐 접속이 안 되는 경우가 있었다.
  - m_contype 멤버 : 무엇으로 들어왔는지.
  - 일반 유저도 그렇고 Guest 역시 체크를 한다.
- vex.conf : 로그레벨이 있다.
- logs > vexd.log > / ERROR 검색
 - appdisk_enable이 N이 된 것을 확인할 수 있다.
- 전탐 ServerDebugLevel을 바꿔준다. 서버와 똑같이
  - 해당 PC에 대해서만 로그 레벨이 변경된다.
  - 전탐에서 보낸 프로토콜 내역이 로그에 다 찍힌다. 프로토콜 문서와 대조한다.
- 막연한 범위라면 ERROR를 검색하면서 먼저 디버깅을 탄다.

# 파일속성일 때, 에러가 나타남
>전탐에서 파일 속성을 눌렀을 때, DB에러가 나타남.

- D1에서 에러가 나타남.
- GetUserName()에서 사용자명 불러올 때.
 - file_info의 maker
 - maker_dm_idx : 도메인간 공유 때문에.
  - master > domain_info의 idx를 바라본다.
  - 이 레코드가 아에 안 들어간 것이 여러 경우가 있더라.
- 그래서 maker_dm_idx값을 업데이트 해줌.

# http port 변경
> web.ini [SYSTEM] HTTP_PORT=80

ini가 업뎃하면서 바뀜

# 원문보관폴더에 자동삭제 동작안함
- vexautodel.log가 오래됐네?
- /vex/tmp/run_vexautodel 에서 autodel 설정값용 임시파일이 있다.
- Y가 값이면 다시 돌 때 살아 있다고 판단해서 뒤에 계속 동작안함.
 - Kill등으로 죽이면 Y가 N로 안 바껴 자동삭제 동작을 안 함.
- 해당 설정값용 임시파일(런언더바)을 삭제해줌.
- /etc/rc.local에서 부팅 시 run_파일을 다 지우게 해둠.

# DRM 암/복호화 설정
- web.ini에 설정이 있다.
- DRM_ENCPATH에 경로가 있으면 DRM 암호화 설정된 것으로 판단.
  - 일반파일을 받을 때, 이걸로 DRM암호화 해서 저장해 준다.
- DRM_DECPATH에 경로가 있으면 복호화 있는 것으로 판단.
- DRM_ICON, DRM_HEADER가 있어야, 체크를 할 수 있다.
 - DRM_HEADER가 기업별로 분류됨.
- DRM_ENC_NOT_VEX_ENC : 일반파일을 업로드 받아서 DRM하고 우리쪽 암호화를 안 한다.
- NO_VEX_ENC : DRM파일이 업로드 됐을 때 우리쪽 암호화를 진행 안 하고 저장한다.

- DRM_ENCPATH의 Shell을 열었더니 경로설정이 잘 못됐었다.

# 하위공유
- 직접 편집 로그와 전탐 로그 다름
- 리비전 보자.

# cherry-pick 썻는데 적용 안 됨.
- tr은 h2로 보낸다.
- 파일 받을 때, file_info.status=0으로 업데이트 하는데
- 파일수신함과 연결 안 된 통합수신함 내의 파일을 autodel이 삭제된다.
- 통합수신함에서 대상의 파일수신함으로 설정 중에 autodel이 동작해서 바로 통합수신함에서 삭제함.
- 그래서 autodel이 통합수신함의 파일 삭제를 안 함.
- checkdb쪽에서 통합수신함의 삭제를 담당한다.
 - 보통 이것은 새벽에 일주일 마다 도니까 괜찮을듯.
- 현대차 독일쪽, 엔지니어링 등에서 적용할려는데.. cherry-pick으로 당겨왔는데, 적용이 안 돼있어서 생긴 이슈이다.

# 라이센스 등록이 안 됨
- cs.officehar.com과 통신해 라이센스를 가져온다.
- web.ini의 CLOSE_NET=Y면 라이센스 파일을 다운받아서 등록할 수도 있다.
- 58버전에서 실패함. 65최신본으론 되더라.

# DB패치하다가 ERROR
- 업체에 수동으로 스키마 변경을하면,
- xml통해서 해결한 것이 아니라, 패치할 때 문제가 생김
- DATASCHEMACHANGELOG테이블에 ms5sum 업데이트 함.

# vexvirus 데몬이 여러개 떠 있는 것
- vexvirus가 여러개 떠 있었다.
- 죽였다 살렸음

# 업로드 딜레이
- 남부발전, 예전 동서발전도 비슷한 증상이 있었음.
- ApUtil.UploadFile()
 - 마지막에 MakeRealFile()을 한다.
  - 0byte파일을 먼저 만들고
  - 동시에 많은 접속 시에, file 갯수를 늘려 유동적으로 /disk1의 쓰기 위치를 바꾸게 하기 위해 사용.
 - MakeFile()에서 file_info 테이블에 넣어준다.
- 이중화 환경에서 같은 파일 시스템을 같이 보고 있다.
- gfs(동기화 위한 파일 시스템)을 사용한다.
- 윈탐은 구분이 안 돼서 일단 업로드를 탄다. 그리고 엄청 많이 요청이 들어온다.
 - gfs에서 굉장히 느림을 LOG를 통해 확인
- disk쪽 문제일 경우가 많다.
- 0byte파일 생성은 윈탐에서 제외함.

# 그룹공유 문의
- admin로그인 시, 그룹공유 폴더가 웹에선 보이고, 전탐에선 안 보임
- 폴더 마스터 들은 그룹공유 폴더를 만들 수 있다.
 - dir_add_info의 master_ui_idx에 master의 idx가 들어간다.
 - 아마 유저를 삭제하면서 master_ui_idx가 남아서 그랬을 것이다.

# sms 알림 쿼리 지원
- 일감 확인

# encp
- 농어촌공사에서만 사용했던 커스텀 실행파일

# 그룹공유 설정이 전탐에서 안 됨
- SOFT_ASSIGN=Y 설정이 되있었는데, vexd에는 반영이 안 돼 있었음. 재시작 안 해서 생긴 문제

# 개인공유 시, 암호 버그

# 전탐 사용량의 할당량이 잘 못 나옴
- 백업의 root를 잘 못 넣음
- 프로토콜 로그를 확인하고 쿼리를 한 번 해본다.
- 쿼리를 따라가 보자

# 내부->외부로 파일이 안 넘어간다.
- 결제+망연계
- 외부서버 trfile 로그가 이상한게 계속 연속으로 찍혀서 행걸린 것이라 의심함

# 결제메뉴가 여러 개 뜨는 증상
- server.ini에 설정이 늘어난 상태일 때다.

# 그룹공유폴더 리스트가 전탐에서 나오는데 웹에서 안 나옴
- 그룹공유 루트폴더가 root_idx, share_idx 값이 잘 못 들어가 있었음.
 - 모두 0으로 초기화한 후 정상 동작

# 직접편집 업로드 실패 이슈
- disk에서 0byte이고 file_info에는 업로드 안 된 파일
 - 다운로드 시에 ftype을 F로 한다.

# 폴더 운영자가 그룹공유 설정/하위공유 설정 누르면 master_ui_idx 값이 잘 못 들어감.
- 강제고 바꿈

# 로그인이 안 됨
- domain_info에서 server_name 변경 후 동작 함.

# 업로드한 파일이 전송제한이 걸림
- 바이러스에 걸렸는데 FN_CheckVirus()함수에 걸렸는데
 - 처리 상태에 따라 결과를 돌려주는데
 - 치료할 수 없는 파일이었음

# 잠긴 파일을 DB에서 풀 수 있나
- 잠긴 파일들은 limit_type=4로 설정돼 있다. 0으로 해주면 잠금이 풀린다.

# drm 파일을 올렸는데 웹탐은 잘 되고 전탐은 에러
- drm에서 -1를 리턴함. 파수 DRM종류가 달라서 복호화가 실패했음

# 폴더 이동시 dir_lock_info 에러 발생
- dir_lock_info정보가 지워지지 않고 남아 있었음.
 - limit_type=0 으로 업데이트 했기 때문에

# 다운로드 리스트 응답 없음
- D0시 db의 정보를 토대로 다운받고 있었다.
 - 문제가 많았다.
- 다운로드 시에 실제 파일 업로드 하는 것을 새로 로직에 추가함.

# 결제완료된 파일이 외부서버로 안 넘어감
- trfile에서 root_idx가 6으로 돼 있어야 함.

# 파일 1000개 업로드를 올렸는데, 기다리기 지쳐 업로드 창 강제 종료
- 후처리 중에 강제 종료
- drm에서 처리가 길거나, 오류가 있었거나 등의 이유로 계속 처리 대기 중 상태가 됨

# 결제파일 외부로 전송이 안 됨
- 결제 창에 에러 내용이 있을 때, 외부로 전송했다가 문제가 있을 때 내부에서 다시 받은 에러 내용임
- checkName에서 파일명이 이상함으로 문제가 됨

# 다중로그인 안 됨

# 업로드 결과 수신 멈춤 현상
- drm 스케줄러가 안 떠있더라
- SOFTCAMP_HOME이 잚 못 돼 있었다.

# docux 에러가 업로드 시에 발생

# 외부망의 transfer의 recv target이 local로 잘 못 설정돼 있었음
- trfile, recvfile, recvresult가 셋트이다.

# E3에러 로그를 삭제 해줌
- checkdb는 로그를 따로 쌓는다.

# 결제 전송된 파일 삭제되는 버그
- 통합수신함에서 파일수신함으로 링크 형성 중에 점검 쉘이 돌아서 통합수신함 파일 삭제됨

# ldap 인증이 오래걸려 타임아웃이남
- 클라이언트 타임아웃을 늘여주면 된다.

# vexvf가 죽지않고 계속 떠있는 현상
- limit.conf, unlimit으로

# 항공우주연구원 파일사지으가 0으로 변환
- 마운트가 풀려서, 파일 사이즈가 0으로

# 안랩 이슈
- zip파일인데 너무 커서 본문검색, 개인정보 검충 처리가 오래걸려서 안 끝나는 걸로 보임

# 특정 폴더를 삭제할 때 '사용자를 찾을 수 없습니다.'
- dir_lock_info에 lock이 걸려서 안 지워지는 현상 발생함.
- limit_type이 0인 것을 file_info에서 찾아서 지워줌

#
